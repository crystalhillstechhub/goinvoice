"use strict";var React=require("react"),mui=require("material-ui"),ModeEdit=require("material-ui/svg-icons/editor/mode-edit").default,Check=require("material-ui/svg-icons/navigation/check").default,Delete=require("material-ui/svg-icons/action/delete").default,times=require("lodash.times"),IconButton=mui.IconButton,Toggle=mui.Toggle,TextField=mui.TextField,RaisedButton=mui.RaisedButton,DatePicker=mui.DatePicker,injectTapEventPlugin=require("react-tap-event-plugin");injectTapEventPlugin(),module.exports=React.createClass({displayName:"exports",getDefaultProps:function(){return{headerColumns:[],rows:[],enableDelete:!0,onChange:function(){}}},getInitialState:function(){return{rows:this.props.rows,hoverValue:!1,currentRow:!1}},contextTypes:{muiTheme:React.PropTypes.object.isRequired},update:function(){var e=this.state.rows.filter(function(e){return e.selected});this.props.onChange(e[0])},getCellValue:function(e){var t=this,n=e&&e.id,a=this.props.headerColumns.map(function(e){return e.type})[n],r=e&&e.selected,l=e&&e.value,i=e&&e.rowId,o=e&&e.header,s=e&&e.width,c=[n,i,o,"text"].join("-"),u=[n,i,o,"date"].join("-"),d={width:s},m={width:s},h=function(e){var a=e.target.value,r=t.state.rows;r[i].columns[n].value=a,t.setState({rows:r})},p=function(e,a){var r=t.state.rows;r[i].columns[n].value=a,t.setState({rows:r})},f=function(e){var a=t.state.rows;a[i].columns[n].value=!a[i].columns[n].value,t.setState({rows:a})};if(o||a&&"ReadOnly"===a)return React.createElement("p",{style:{color:"#888"}},l);if(a)if(r){if("TextField"===a)return React.createElement(TextField,{id:c,onChange:h,style:d,value:l});if("DatePicker"===a)return React.createElement(DatePicker,{id:u,onChange:p,mode:"landscape",style:m,value:l});if("Toggle"===a)return React.createElement(Toggle,{onToggle:f,toggled:l})}else{if("Toggle"===a)return React.createElement(Toggle,{disabled:!0,onToggle:f,toggled:l});if("DatePicker"===a)return React.createElement(DatePicker,{id:u,onChange:p,mode:"landscape",style:m,value:l,disabled:Boolean(!0)})}return React.createElement(TextField,{id:c,style:d,disabled:!0,value:l})},renderHeader:function(){var e={columns:this.props.headerColumns.map(function(e,t){return{value:e.value}}),header:!0};return this.renderRow(e)},renderRow:function(e){var t=this,n=this,a=e.columns,r={width:"100%",display:"flex",flexFlow:"row nowrap",padding:e.header?0:12,border:0,borderBottom:"1px solid #ccc",height:50},l={display:"flex",flexFlow:"row nowrap",width:50,height:24,alignItems:"center"},i={display:"flex",flexFlow:"row nowrap",width:50,height:24,alignItems:"center",padding:"0 12 0"},o=e.id,s=["row",o].join("-"),c=function(e){var t=n.state.rows;t.forEach(function(e,t){o!==t&&(e.selected=!1)}),t[o].selected=!t[o].selected,n.setState({rows:t})},u=n.state.rows[o],d=u&&u.selected||!1,m=d?React.createElement(Check,null):React.createElement(ModeEdit,null),h=d?"Done":"Edit",p=function(e){var t=n.state.rows;t.forEach(function(e,n){o===n&&t.splice(n,1)}),t.forEach(function(e,t){e.id=t}),n.setState({rows:t})},f=function(e){d&&n.update(),c()},w=!this.props.enableDelete||d||e.header?React.createElement("div",{style:i}):React.createElement(IconButton,{style:i,tooltip:"Delete this row",onClick:p},React.createElement(Delete,null)),g=e.header?React.createElement("div",{style:l}):React.createElement(IconButton,{style:l,tooltip:h,onClick:f},m);return React.createElement("div",{key:s,className:"row",style:r},g,a.map(function(n,a){var r={display:"flex",flexFlow:"row nowrap",flexGrow:.15,flexBasis:"content",alignItems:"center",height:30,width:t.props.headerColumns.map(function(e){return e&&e.width||!1})[a]||200},l=["column",a].join("-");return n.selected=d,n.rowId=o,n.id=a,n.header=e.header,n.width=r.width,React.createElement("div",{key:l,className:"cell",style:r},React.createElement("div",null,t.getCellValue(n)))}),w)},render:function(){var e=this,t=this,n={display:"flex",flexFlow:"column nowrap",justifyContent:"space-between",alignItems:"center",fontFamily:"Roboto, sans-serif"},a={display:"flex",flexFlow:"row nowrap",marginTop:10},r=this.state.rows,l=this.props.headerColumns.map(function(e){return e.type}),i=function(e){var n=times(l.length,function(e){return{value:{TextField:"",Toggle:!0}[l[e]]}}),a=r.map(function(e){return e.selected&&(t.update(),e.selected=!1),e});a.push({columns:n,selected:!0}),t.setState({rows:a})};return React.createElement("div",{className:"container",style:n},this.renderHeader(),r.map(function(t,n){return t.id=n,e.renderRow(t)}),React.createElement(RaisedButton,{onClick:i,style:a,label:"Add Row"}))}});
